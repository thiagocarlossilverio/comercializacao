<?phpclass CadastroController extends Zend_Controller_Action {    public function indexAction() {        $termo = new Zend_Session_Namespace("termo");        if ($termo->aceito != 'yes') {            $this->_helper->FlashMessenger->addMessage(array('erro' => 'Antes de registrar-se, por favor, leia com atenção o termo de uso abaixo:'));            $this->_redirect("/cadastro/termo");        }        $ModelClientes = new Admin_Model_Clientes();        if ($this->_request->isPost()) {            $data = $this->_request->getPost();            if (empty($data['nome1'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira o 1º nome'));                $this->_redirect("/cadastro");            }            if (empty($data['nome2'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira o 2º nome'));                $this->_redirect("/cadastro");            }            if (empty($data['doc1'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira o 1º Documento'));                $this->_redirect("/cadastro");            }            if (empty($data['doc2'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira o 2º Documento'));                $this->_redirect("/cadastro");            }            if (empty($data['cep'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira o CEP'));                $this->_redirect("/cadastro");            }            if (empty($data['cidade'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira a cidade'));                $this->_redirect("/cadastro");            }            if (empty($data['estado'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira o estado'));                $this->_redirect("/cadastro");            }            if (empty($data['proprio'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Selecione se o frigorífico é próprio'));                $this->_redirect("/cadastro");            }            if (empty($data['capacidade'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira a capacidade do frigorífico'));                $this->_redirect("/cadastro");            }            if (empty($data['frequencia'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira a frequência da capacidade'));                $this->_redirect("/cadastro");            }            if (empty($data['telefone'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira o telefone'));                $this->_redirect("/cadastro");            }            if (empty($data['email'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira o E-mail'));                $this->_redirect("/cadastro");            }            if (empty($data['senha'])) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Insira a senha'));                $this->_redirect("/cadastro");            }            if ($data['senha'] !== $data['confirma_senha']) {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'As senhas não se coincide!'));                $this->_redirect("/cadastro");            }            if (!$data['tipo_pessoa']) {                $data['tipo_pessoa'] = 1;            }            $id = $ModelClientes->insert($data);            if ($id) {                $ModelEnderecos = new Admin_Model_ClienteEnderecos();                $data_cadastro = date('Y-m-d H:i:s');                $array_enderecos = array(                    'cliente' => $id,                    'numero' => $data['numero'],                    'rua' => $data['endereco'],                    'bairro' => $data['bairro'],                    'cep' => $data['cep'],                    'cidade' => $data['cidade'],                    'estado' => $data['estado'],                    'data_cadastro' => $data_cadastro                );                $ModelEnderecos->insert($array_enderecos);                // Cria a sessão do cliente                $login = new Zend_Session_Namespace("login");                $login->id = $id;                $login->nome1 = $data['nome1'];                $login->doc1 = $data['doc1'];                $login->doc2 = $data['doc2'];                $login->logado = TRUE;                $login->email = $data['email'];                $ip = $_SERVER['REMOTE_ADDR'];                $data = date('Y-m-d H:i:s');                /* Atualizo o data de ultimo login */                //  $ModelClientes->update(array('ultimo_acesso' => $data, 'ip' => $ip), "id =$id");                unset($termo->aceito);                $this->_helper->FlashMessenger->addMessage(array('sucesso' => 'cadastro realizado com sucesso!'));                $this->_redirect("/minha-conta");            } else {                $this->_helper->FlashMessenger->addMessage(array('erro' => 'Não foi possível fazer o cadastro!'));                $this->_redirect("/cadastro");            }        }    }    public function termoAction() {        $termo = new Zend_Session_Namespace("termo");        $aceito = $this->_request->getParam('aceito');        if ($aceito == 'yes') {            $termo->aceito = 'yes';            $this->_redirect("/cadastro");        }        if ($termo->aceito == 'yes') {            $this->_redirect("/cadastro");        }    }    public function completaEnderecoAction() {        $this->getHelper('layout')->disableLayout();        $cep = $this->_request->getParam('cep');        $reg = simplexml_load_file("http://cep.republicavirtual.com.br/web_cep.php?formato=xml&cep=" . $cep);        $dados['sucesso'] = (string) $reg->resultado;        $dados['rua'] = (string) $reg->tipo_logradouro . ' ' . $reg->logradouro;        $dados['bairro'] = (string) $reg->bairro;        $dados['cidade'] = (string) $reg->cidade;        $dados['estado'] = (string) $reg->uf;        echo json_encode($dados);        die;    }    public function cancelarAction() {        Zend_Session::namespaceUnset("termo");        $this->_redirect('/');    }    public function ajaxDocAction() {        $this->_helper->viewRenderer->setNoRender(true);        $this->_helper->layout->disableLayout();        $doc = $this->_request->getParam('doc');        $ModelClientes = new Admin_Model_Clientes();        $result = $ModelClientes->GetDoc($doc);        if ($result) {            die('1');        } else {            die('0');        }    }    public function ajaxEmailAction() {        $this->_helper->viewRenderer->setNoRender(true);        $this->_helper->layout->disableLayout();        $email = $this->_request->getParam('email');        $ModelClientes = new Admin_Model_Clientes();        $result = $ModelClientes->GetEmail($email);        if ($result) {            die('1');        } else {            die('0');        }    }}